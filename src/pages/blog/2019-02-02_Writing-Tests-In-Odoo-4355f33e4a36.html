<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>Writing Tests In Odoo</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">Writing Tests In Odoo</h1>
</header>
<section data-field="subtitle" class="p-summary">
Organizing, Writing, and Running Automated Tests
</section>
<section data-field="body" class="e-content">
<section name="c982" class="section section--body section--first"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="610f" id="610f" class="graf graf--h3 graf--leading graf--title">Writing Tests In Odoo</h3><h4 name="5111" id="5111" class="graf graf--h4 graf-after--h3 graf--subtitle">Organizing, Writing, and Running Automated Tests</h4><figure name="58a5" id="58a5" class="graf graf--figure graf-after--h4"><img class="graf-image" data-image-id="0*PoZG0rBa7j6JawC0" data-width="3888" data-height="2592" data-unsplash-photo-id="3GZi6OpSDcY" data-is-featured="true" src="https://cdn-images-1.medium.com/max/800/0*PoZG0rBa7j6JawC0"><figcaption class="imageCaption">Photo by <a href="https://unsplash.com/@nicolasthomas?utm_source=medium&amp;utm_medium=referral" data-href="https://unsplash.com/@nicolasthomas?utm_source=medium&amp;utm_medium=referral" class="markup--anchor markup--figure-anchor" rel="photo-creator noopener" target="_blank">Nicolas Thomas</a> on <a href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" data-href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" class="markup--anchor markup--figure-anchor" rel="photo-source noopener" target="_blank">Unsplash</a></figcaption></figure><h3 name="905d" id="905d" class="graf graf--h3 graf-after--figure">Introduction</h3><p name="96d6" id="96d6" class="graf graf--p graf-after--h3">Testing with Odoo, in any version, is not 100% straight forward. There are some different tricks and requirements that aren’t always made clear.</p><p name="a0cb" id="a0cb" class="graf graf--p graf-after--p">So I wanted to write up everything that my team and I at <a href="https://bluestingray.com" data-href="https://bluestingray.com" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">Blue Stingray</a> have learned about Odoo testing over the last few years. We’ve luckily been able to learn a ton.</p><p name="7831" id="7831" class="graf graf--p graf-after--p">This is not an explanation on <strong class="markup--strong markup--p-strong">what</strong> to test. There are plenty of great articles and books out there for what should you be testing, and maybe I’ll write up a summary of those one day. But for now, this is strictly an explanation on how to organize, write, and run some example tests in Odoo.</p><p name="ff06" id="ff06" class="graf graf--p graf-after--p">I will try to thoroughly cover:</p><ul class="postList"><li name="d419" id="d419" class="graf graf--li graf-after--p">Setting up a module for tests</li><li name="6da9" id="6da9" class="graf graf--li graf-after--li">Writing a test within the Odoo framework boundaries</li><li name="0ee7" id="0ee7" class="graf graf--li graf-after--li">Running your Odoo / module test suite</li></ul><h3 name="9abd" id="9abd" class="graf graf--h3 graf-after--li">Requirements</h3><p name="1a60" id="1a60" class="graf graf--p graf-after--h3">What do you need?</p><ul class="postList"><li name="298b" id="298b" class="graf graf--li graf-after--p">A running instance of Odoo.</li><li name="7753" id="7753" class="graf graf--li graf-after--li">A custom Odoo module (I’ll provide a sample).</li></ul><p name="7be5" id="7be5" class="graf graf--p graf-after--li">I will be referencing Odoo 12, but Odoo 9 to 12 have pretty similar testing frameworks. There were no huge changes between recent versions.</p><p name="765a" id="765a" class="graf graf--p graf-after--p">Also, you may want to check out a <a href="https://medium.com/@reedrehg/easier-odoo-development-278bbaab38c8" data-href="https://medium.com/@reedrehg/easier-odoo-development-278bbaab38c8" class="markup--anchor markup--p-anchor" target="_blank">Simple Introduction To Docker Development In Odoo</a> since I will be referencing some Docker commands.</p><h3 name="7b56" id="7b56" class="graf graf--h3 graf-after--p">Module Structure</h3><p name="8faf" id="8faf" class="graf graf--p graf-after--h3">Let’s create a sample module. For reference, all sample code is in a repository at <a href="https://github.com/holdenrehg/sample_test_module" data-href="https://github.com/holdenrehg/sample_test_module" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">https://github.com/holdenrehg/sample_test_module</a>.</p><pre name="1d4e" id="1d4e" class="graf graf--pre graf-after--p">test_module<br>├── doc<br>├── helpers<br>├── models<br>├── security<br>├── static<br>├── tests<br>├── __manifest__.py<br>├── __init__.py<br>├── init.xml<br>└── readme.md</pre><p name="8151" id="8151" class="graf graf--p graf-after--pre">I’m creating a sample module called <code class="markup--code markup--p-code">test_module</code> which will contain all of my sample tests and code. You will see quite a few directories above, many just “standards” introduced by Odoo in general, but the most important directory will be <code class="markup--code markup--p-code">tests</code> .</p><h4 name="84cc" id="84cc" class="graf graf--h4 graf-after--p">The Tests Directory</h4><pre name="b8f7" id="b8f7" class="graf graf--pre graf-after--h4">test_module/tests/<br>├── unit<br>│   ├── test_tweeter_helper.py<br>│   ├── test_twitter_tweet_model.py<br>│   ├── test_string_helper.py<br>│   ├── test_twitter_settings_model.py<br>│   └── __init__.py<br>└── __init__.py</pre><p name="e37f" id="e37f" class="graf graf--p graf-after--pre">You can organize your tests directory however you would like, but I often will try to break up different types of tests. In the example above you can see that we have <code class="markup--code markup--p-code">tests/unit</code> for all of our unit tests. Maybe if we kept building this out, we would introduce <code class="markup--code markup--p-code">tests/integration</code> , <code class="markup--code markup--p-code">tests/security</code> , etc.</p><h4 name="c3ff" id="c3ff" class="graf graf--h4 graf-after--p">Some Sample Models and Helpers</h4><p name="e232" id="e232" class="graf graf--p graf-after--h4">Also inside of our module, we have 2 models and 2 helpers to use as examples for writing some tests.</p><p name="d70d" id="d70d" class="graf graf--p graf-after--p">Again, this is just convention to have a <code class="markup--code markup--p-code">models</code> folder and a <code class="markup--code markup--p-code">helpers</code> folder for Odoo modules, but as long as your <code class="markup--code markup--p-code">__init__</code> files are properly importing files you can organize your module however you would like.</p><pre name="63d9" id="63d9" class="graf graf--pre graf-after--p">test_module/helpers<br>├── string.py<br>├── tweeter.py<br>└── __init__.py</pre><pre name="525f" id="525f" class="graf graf--pre graf-after--pre graf--trailing">test_module/models/<br>├── twitter<br>│   ├── tweet.py<br>│   ├── settings.py<br>│   └── __init__.py<br>└── __init__.py</pre></div></div></section><section name="ae47" class="section section--body"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="e320" id="e320" class="graf graf--h3 graf--leading">Module Files</h3><p name="a9c9" id="a9c9" class="graf graf--p graf-after--h3">Let’s dig into the contents of some of these sample files that I’ve written for you. I’m not quite going to get into the <code class="markup--code markup--p-code">tests</code> folder until the section below.</p><h4 name="a915" id="a915" class="graf graf--h4 graf-after--p">__manifest__.py</h4><p name="8ac2" id="8ac2" class="graf graf--p graf-after--h4">Because we are using 12.0 we require a manifest file. If we were looking at 9.0 and back we may have an <code class="markup--code markup--p-code">__openerp__.py</code> file in the root of our module, but the general contents will be the same.</p><figure name="a061" id="a061" class="graf graf--figure graf--iframe graf-after--p"><script src="https://gist.github.com/holdenrehg/a7b81672d98a795e2b816b03a79c71c2.js"></script></figure><h4 name="0bbf" id="0bbf" class="graf graf--h4 graf-after--figure">A Couple Sample Models</h4><p name="2a13" id="2a13" class="graf graf--p graf-after--h4">We have an extremely creative, and definitely unique (no one has used Twitter for their development tutorial before, right?) set of models to mess around with.</p><p name="e518" id="e518" class="graf graf--p graf-after--p">The first is a Twitter settings model. This is going to be a class that stores a username and a password. These would be credentials for accessing Twitter accounts if this module was expanding out to a functioning module.</p><figure name="5a0d" id="5a0d" class="graf graf--figure graf--iframe graf-after--p"><script src="https://gist.github.com/holdenrehg/537886753b06792b4b7919faea89d662.js"></script></figure><p name="7350" id="7350" class="graf graf--p graf-after--figure">The second is a Tweet model. This is a data model that contains the description of the tweet, and constraints for the tweet. For example, you cannot generate a tweet that is longer than 140 character.</p><p name="6110" id="6110" class="graf graf--p graf-after--p">This gives us a clear restriction where we can write some tests to ensure that restriction is being enforced by the system.</p><figure name="f488" id="f488" class="graf graf--figure graf--iframe graf-after--p"><script src="https://gist.github.com/holdenrehg/528a0cc5efe954b482802f6165108d06.js"></script></figure><h4 name="ad8b" id="ad8b" class="graf graf--h4 graf-after--figure">A Couple Sample Helpers</h4><p name="11f8" id="11f8" class="graf graf--p graf-after--h4">Now we need 2 helpers. We have the Twitter data models, but we need an easy way to make a tweet and an easy way to truncate off characters down.</p><p name="8385" id="8385" class="graf graf--p graf-after--p">So that leaves us with a <code class="markup--code markup--p-code">string.py</code> helper and a <code class="markup--code markup--p-code">tweeter.py</code> helper for our <code class="markup--code markup--p-code">Tweeter</code> class.</p><figure name="f3bb" id="f3bb" class="graf graf--figure graf--iframe graf-after--p"><script src="https://gist.github.com/holdenrehg/f93290b5b0956fab508430f24474b70c.js"></script></figure><figure name="c7bf" id="c7bf" class="graf graf--figure graf--iframe graf-after--figure graf--trailing"><script src="https://gist.github.com/holdenrehg/5aad09a3122e591402f35a3e09198904.js"></script></figure></div></div></section><section name="5c9c" class="section section--body"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="925a" id="925a" class="graf graf--h3 graf--leading">Writing A Test — Requirements</h3><p name="0fd5" id="0fd5" class="graf graf--p graf-after--h3">Alright, we got a sweet Twitter module built out now.</p><p name="da2c" id="da2c" class="graf graf--p graf-after--p">How do we write a test for it? First, there are some requirements specific to the Odoo testing framework that we must adhere to. You’ll see how these apply in the sample tests I’ve written, but here’s what you need to think about:</p><ul class="postList"><li name="e89b" id="e89b" class="graf graf--li graf-after--p">All tests must be included in <code class="markup--code markup--li-code">tests/__init__.py</code></li><li name="25ed" id="25ed" class="graf graf--li graf-after--li">All tests must extend an Odoo test case class</li><li name="1ff9" id="1ff9" class="graf graf--li graf-after--li">All tests must be put inside of the <code class="markup--code markup--li-code">tests</code> directory in your module</li><li name="9d9f" id="9d9f" class="graf graf--li graf-after--li">All test files must start with <code class="markup--code markup--li-code">test_&lt;what_your_testing&gt;.py</code></li><li name="862d" id="862d" class="graf graf--li graf-after--li">All test methods must start with <code class="markup--code markup--li-code">def test_&lt;what_your_testing&gt;(self):</code></li></ul><h4 name="975a" id="975a" class="graf graf--h4 graf-after--li">All Tests Must Be Included In `tests/__init__.py`</h4><p name="d749" id="d749" class="graf graf--p graf-after--h4">Even if they are nested deeper. So in the case of our sample module, we have 4 tests:</p><ul class="postList"><li name="36d7" id="36d7" class="graf graf--li graf-after--p"><code class="markup--code markup--li-code">tests/unit/test_string_helper.py</code></li><li name="f02f" id="f02f" class="graf graf--li graf-after--li"><code class="markup--code markup--li-code">tests/unit/test_tweeter_helper.py</code></li><li name="0a1e" id="0a1e" class="graf graf--li graf-after--li"><code class="markup--code markup--li-code">tests/unit/test_twitter_settings_model.py</code></li><li name="f9ce" id="f9ce" class="graf graf--li graf-after--li"><code class="markup--code markup--li-code">tests/unit/test_twitter_tweet_model.py</code></li></ul><p name="e960" id="e960" class="graf graf--p graf-after--li">If you look at the <code class="markup--code markup--p-code">tests/__init__.py</code> file then you will see the following:</p><pre name="d5ed" id="d5ed" class="graf graf--pre graf-after--p"># -*- coding: utf-8 -*-<br>from .unit import test_string_helper<br>from .unit import test_tweeter_helper<br>from .unit import test_twitter_settings_model<br>from .unit import test_twitter_tweet_model</pre><p name="17a0" id="17a0" class="graf graf--p graf-after--pre">Make sure to always include your test file in this <code class="markup--code markup--p-code">__init__.py</code> file for the system to recognize the test.</p><h4 name="71bc" id="71bc" class="graf graf--h4 graf-after--p">Extend An Odoo Test Class</h4><p name="7fc2" id="7fc2" class="graf graf--p graf-after--h4">There are some pre-existing test classes for you to work with, but you need to extend one of them.</p><pre name="4e8b" id="4e8b" class="graf graf--pre graf-after--p">odoo.tests.common.TransactionCase &lt;--- Most common<br>odoo.tests.common.SingleTransactionCase<br>odoo.tests.common.HttpCase<br>odoo.tests.common.SavepointCase</pre><p name="e7f1" id="e7f1" class="graf graf--p graf-after--pre">So your tests classes will look something like the following:</p><pre name="8031" id="8031" class="graf graf--pre graf-after--p"># -*- coding: utf-8 -*-<br>from odoo.tests import TransactionCase</pre><pre name="d703" id="d703" class="graf graf--pre graf-after--pre"><br>class MyTest(TransactionCase):<br>    ...</pre><h4 name="09a1" id="09a1" class="graf graf--h4 graf-after--pre"><strong class="markup--strong markup--h4-strong">Put Your Tests In The Tests Folder</strong></h4><p name="8686" id="8686" class="graf graf--p graf-after--h4">You can get a little bit creative with your module organization, except when it comes to things like tests, make sure they are in the <code class="markup--code markup--p-code">tests</code> folder.</p><p name="a9fb" id="a9fb" class="graf graf--p graf-after--p">Otherwise, the testing framework will ignore them.</p><pre name="d79f" id="d79f" class="graf graf--pre graf-after--p">test_module/tests/<br>├── unit<br>│   ├── test_tweeter_helper.py<br>│   ├── test_twitter_tweet_model.py<br>│   ├── test_string_helper.py<br>│   ├── test_twitter_settings_model.py<br>│   └── __init__.py<br>└── __init__.py</pre><h4 name="a3cf" id="a3cf" class="graf graf--h4 graf-after--pre">All Test Files Must Start With test_</h4><p name="c5c0" id="c5c0" class="graf graf--p graf-after--h4">As you are making your tests (and putting them in the <code class="markup--code markup--p-code">tests</code> folder), make sure that all of your test files are prefixed with <code class="markup--code markup--p-code">test_</code> .</p><p name="06b5" id="06b5" class="graf graf--p graf-after--p">There’s a reason why, in my example, that my test files are named things like <code class="markup--code markup--p-code">test_tweeter_helper.py</code> or <code class="markup--code markup--p-code">test_string_helper.py</code> .</p><h4 name="273f" id="273f" class="graf graf--h4 graf-after--p">All Test Methods Must Start With test_</h4><p name="c483" id="c483" class="graf graf--p graf-after--h4">I haven’t actually shown you a full test class or method yet, but when you add methods to your test class (which is inside of the <code class="markup--code markup--p-code">tests</code> folder and inside of a file prepended with <code class="markup--code markup--p-code">tests_&lt;filename&gt;.py</code>) then you also have to prefix it with <code class="markup--code markup--p-code">test_</code> .</p><p name="31dd" id="31dd" class="graf graf--p graf-after--p">I know it’s feeling a little overkill, but this is the last <code class="markup--code markup--p-code">test_</code> you will need.</p><pre name="672d" id="672d" class="graf graf--pre graf-after--p"># -*- coding: utf-8 -*-<br>from odoo.tests import TransactionCase</pre><pre name="8598" id="8598" class="graf graf--pre graf-after--pre">class MyTest(TransactionCase):<br>    def test_should_evaluate_true(self):  &lt;----<br>        ...</pre><h3 name="39ab" id="39ab" class="graf graf--h3 graf-after--pre">Writing A Test — Examples</h3><p name="baf7" id="baf7" class="graf graf--p graf-after--h3">Now you know those 5 requirements above for actually writing a test.</p><p name="ca32" id="ca32" class="graf graf--p graf-after--p">Here’s what one looks like:</p><figure name="8508" id="8508" class="graf graf--figure graf--iframe graf-after--p"><script src="https://gist.github.com/holdenrehg/e655109d8fd4dd034435b5bc5b649247.js"></script></figure><p name="f87b" id="f87b" class="graf graf--p graf-after--figure">This is our unit test for the string helper. So this is under <code class="markup--code markup--p-code">tests/unit/test_string_helper.py</code> and is testing our helper at <code class="markup--code markup--p-code">helpers/string.py</code> .</p><p name="a890" id="a890" class="graf graf--p graf-after--p">I’m not going to dig too far into what you should be trying to test for or all of the assertion method available to you (check out the <a href="https://docs.python.org/2/library/unittest.html#assert-methods" data-href="https://docs.python.org/2/library/unittest.html#assert-methods" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">list of assertion methods for unittest2</a> or the <code class="markup--code markup--p-code">odoo/test/common.py</code> file in Odoo core.)</p><p name="1e71" id="1e71" class="graf graf--p graf-after--p">Hopefully, you can get a general idea from the example above for how to write some sample test methods.</p><p name="9d4b" id="9d4b" class="graf graf--p graf-after--p">I wrote 3 methods in that example above:</p><ol class="postList"><li name="c36b" id="c36b" class="graf graf--li graf-after--p">Does our string helper properly truncate a string when the string is longer than the size limit?</li><li name="b0ae" id="b0ae" class="graf graf--li graf-after--li">Does our string helper do nothing when the string is exactly the size limit?</li><li name="e710" id="e710" class="graf graf--li graf-after--li">Does our string helper do nothing when the string is less than the size limit?</li></ol><p name="30d9" id="30d9" class="graf graf--p graf-after--li">To do this, I need to import our string helper from the module via a <code class="markup--code markup--p-code">from odoo.addons.test_module.helpers import string</code> call, create some sample strings to work with, call the <code class="markup--code markup--p-code">string.limit(...)</code> function that I’m trying to test, and then assert that the return values are equal to the expected results.</p><pre name="0c43" id="0c43" class="graf graf--pre graf-after--p">def test_string_should_do_nothing_when_same_size(self):<br>    sample_str = &#39;This is my sample string.&#39;<br>    sample_str_len = len(sample_str)<br>    <br>    self.assertEqual(<br>        # Actual results from function call...<br>        len(string.limit(sample_str, sample_str_len)),</pre><pre name="d5e0" id="d5e0" class="graf graf--pre graf-after--pre">        # Expected results from the function call...<br>        sample_str_len<br>    )</pre><p name="3809" id="3809" class="graf graf--p graf-after--pre">Make sure to check out the other 3 test classes that I wrote as well for some more example tests:</p><div name="78e8" id="78e8" class="graf graf--mixtapeEmbed graf-after--p graf--trailing"><a href="https://github.com/holdenrehg/sample_test_module/tree/master/test_module/tests/unit" data-href="https://github.com/holdenrehg/sample_test_module/tree/master/test_module/tests/unit" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://github.com/holdenrehg/sample_test_module/tree/master/test_module/tests/unit"><strong class="markup--strong markup--mixtapeEmbed-strong">holdenrehg/sample_test_module</strong><br><em class="markup--em markup--mixtapeEmbed-em">Sample Odoo 12.0 Testing Module. Contribute to holdenrehg/sample_test_module development by creating an account on…</em>github.com</a><a href="https://github.com/holdenrehg/sample_test_module/tree/master/test_module/tests/unit" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="06b3f9806822de6b4d76ea6cc3c280f1" data-thumbnail-img-id="0*UcT-f9GhinvXFyDZ" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/0*UcT-f9GhinvXFyDZ);"></a></div></div></div></section><section name="43bf" class="section section--body section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="b37c" id="b37c" class="graf graf--h3 graf--leading">Running Tests</h3><p name="3bef" id="3bef" class="graf graf--p graf-after--h3">Finally, we can try to run some tests. I’m going to show you how to run these via Docker and Docker Compose, but you can also run these directly from the <code class="markup--code markup--p-code">odoo.py</code> or <code class="markup--code markup--p-code">odoo-bin</code> executables.</p><h4 name="c7a3" id="c7a3" class="graf graf--h4 graf-after--p">Requirements</h4><p name="6fbb" id="6fbb" class="graf graf--p graf-after--h4">More requirements.</p><p name="f14e" id="f14e" class="graf graf--p graf-after--p">Similar to the requirements for writing a test. There are a few things that we need for running the test suite.</p><ul class="postList"><li name="eb79" id="eb79" class="graf graf--li graf-after--p">A database instance WITH demo data. So when you are creating a database from that database creation screen, <strong class="markup--strong markup--li-strong">make sure to mark to include demo data</strong>.</li><li name="4156" id="4156" class="graf graf--li graf-after--li">Run odoo with the <code class="markup--code markup--li-code">--test-enable</code> flag.</li><li name="eb69" id="eb69" class="graf graf--li graf-after--li">Run odoo with the <code class="markup--code markup--li-code">-d {my_database}</code> flag.</li><li name="40a2" id="40a2" class="graf graf--li graf-after--li">Run odoo with the <code class="markup--code markup--li-code">-i {modules_to_install}</code> flag.</li><li name="c592" id="c592" class="graf graf--li graf-after--li">(optional) Sometimes it’s also nice to use <code class="markup--code markup--li-code">--stop-after-init</code> .</li></ul><h4 name="e4bc" id="e4bc" class="graf graf--h4 graf-after--li">Run The Tests</h4><p name="677e" id="677e" class="graf graf--p graf-after--h4"><strong class="markup--strong markup--p-strong">With Docker</strong></p><ol class="postList"><li name="9545" id="9545" class="graf graf--li graf-after--p">Clone down the sample project</li></ol><pre name="d7cd" id="d7cd" class="graf graf--pre graf-after--li">$ git clone <a href="https://github.com/holdenrehg/sample_test_module.git" data-href="https://github.com/holdenrehg/sample_test_module.git" class="markup--anchor markup--pre-anchor" rel="nofollow noopener" target="_blank">https://github.com/holdenrehg/sample_test_module.git</a><br>$ cd sample_test_module</pre><p name="b503" id="b503" class="graf graf--p graf-after--pre">2. Start up the instance and create a new database called <code class="markup--code markup--p-code">test_1</code> <strong class="markup--strong markup--p-strong">with demo data</strong>. If you do not make your database first, the command in step #3 will automatically create the database but also run tests on core modules (this can take a while).</p><pre name="d981" id="d981" class="graf graf--pre graf-after--p">$ docker-compose up -d</pre><p name="35a3" id="35a3" class="graf graf--p graf-after--pre">3. Stop your instance and then re-run the container with the proper arguments for testing.</p><pre name="49cc" id="49cc" class="graf graf--pre graf-after--p">$ docker-compose stop<br>$ docker-compose run web \<br>      --test-enable \<br>      --stop-after-init \<br>      -d test_1 \<br>      -i test_module</pre><p name="6afd" id="6afd" class="graf graf--p graf-after--pre"><strong class="markup--strong markup--p-strong">Without Docker</strong></p><p name="5978" id="5978" class="graf graf--p graf-after--p">If you are running your own local instance:</p><ol class="postList"><li name="07d8" id="07d8" class="graf graf--li graf-after--p">Clone down the sample project and move the addon into your addons directory.</li></ol><pre name="7e70" id="7e70" class="graf graf--pre graf-after--li">$ git clone <a href="https://github.com/holdenrehg/sample_test_module.git" data-href="https://github.com/holdenrehg/sample_test_module.git" class="markup--anchor markup--pre-anchor" rel="nofollow noopener noopener" target="_blank">https://github.com/holdenrehg/sample_test_module.git</a><br>$ mv sample_test_module/test_module {my_project/my_addons/}</pre><p name="b3db" id="b3db" class="graf graf--p graf-after--pre">2. Make a database called <code class="markup--code markup--p-code">test_1</code> <strong class="markup--strong markup--p-strong">with demo data</strong>. If you do not make your database first, the command in step #3 will automatically create the database but also run tests on core modules (this can take a while).</p><p name="6dc6" id="6dc6" class="graf graf--p graf-after--p">3. Run your odoo instance with the proper arguments for testing.</p><pre name="5367" id="5367" class="graf graf--pre graf-after--p">$ odoo.py \<br>      --test-enable \<br>      --stop-after-init \<br>      -d test_1 \<br>      -i test_module</pre><h4 name="4107" id="4107" class="graf graf--h4 graf-after--pre">Test Results</h4><p name="86d0" id="86d0" class="graf graf--p graf-after--h4"><strong class="markup--strong markup--p-strong">Good Results</strong></p><p name="9ed3" id="9ed3" class="graf graf--p graf-after--p">If everything runs successfully then you will see the following in the log:</p><figure name="87bb" id="87bb" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*YVBjDU49TMn8JbsYPJnHHg.png" data-width="2881" data-height="1464" src="https://cdn-images-1.medium.com/max/800/1*YVBjDU49TMn8JbsYPJnHHg.png"></figure><p name="8c05" id="8c05" class="graf graf--p graf-after--figure">It gives you a lot of information to parse, but you will be looking for each section that says something similar to<code class="markup--code markup--p-code">odoo.addons.test_module.tests.unit.test_string_helper running test</code> because that will be an individual test class/test case. You can see where it runs each method in the test case.</p><p name="cfbf" id="cfbf" class="graf graf--p graf-after--p">Example Results For String Helper Tests</p><pre name="f9a3" id="f9a3" class="graf graf--pre graf-after--p">2019-02-02 20:11:36,199 1 INFO test_1 odoo.modules.module: odoo.addons.test_module.tests.unit.test_string_helper running tests.<br>2019-02-02 20:11:36,200 1 INFO test_1 odoo.addons.test_module.tests.unit.test_string_helper: test_string_should_do_nothing_when_less_than (odoo.addons.test_module.tests.unit.test_string_helper.StringHelperTest)<br>2019-02-02 20:11:36,278 1 INFO test_1 odoo.addons.test_module.tests.unit.test_string_helper: test_string_should_do_nothing_when_same_size (odoo.addons.test_module.tests.unit.test_string_helper.StringHelperTest)<br>2019-02-02 20:11:36,279 1 INFO test_1 odoo.addons.test_module.tests.unit.test_string_helper: test_string_should_truncate_when_greater (odoo.addons.test_module.tests.unit.test_string_helper.StringHelperTest)<br>2019-02-02 20:11:36,280 1 INFO test_1 odoo.addons.test_module.tests.unit.test_string_helper: Ran 3 tests in 0.080s<br>2019-02-02 20:11:36,280 1 INFO test_1 odoo.addons.test_module.tests.unit.test_string_helper: OK</pre><p name="94f6" id="94f6" class="graf graf--p graf-after--pre"><strong class="markup--strong markup--p-strong">Bad Results</strong></p><p name="97d1" id="97d1" class="graf graf--p graf-after--p">All the tests don’t pass all the time, so let’s check out our log for a failing test.</p><figure name="0cd0" id="0cd0" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*8Il0KAE2qu0ciDIO-hWlkw.png" data-width="2751" data-height="910" src="https://cdn-images-1.medium.com/max/800/1*8Il0KAE2qu0ciDIO-hWlkw.png"></figure><p name="4d7f" id="4d7f" class="graf graf--p graf-after--figure">You’ll see where again we get the logger for <code class="markup--code markup--p-code">odoo.addons.test_module.tests.unit.test_string_helper running tests</code> and then each method that runs below it.</p><p name="6a5b" id="6a5b" class="graf graf--p graf-after--p">In this scenario (where I forced a method to fail) we can see a stack trace with the problem:</p><pre name="7437" id="7437" class="graf graf--pre graf-after--p">FAIL: test_string_should_truncate_when_greater (odoo.addons.test_module.tests.unit.test_string_helper.StringHelperTest)<br>Traceback (most recent call last):<br>`   File &quot;/mnt/extra-<br>addons/test_module/tests/unit/test_string_helper.py&quot;, line 8, in test_string_should_truncate_when_greater<br>`     self.assertEqual(len(string.limit(&#39;A short string...&#39;, size=6)), 5)<br>` AssertionError: 6 != 5</pre><p name="130e" id="130e" class="graf graf--p graf-after--pre">Pretty clear that our <code class="markup--code markup--p-code">string.limit</code> method ran with <code class="markup--code markup--p-code">size=6</code> but we were expecting the length of the final string to be equal to 5. This looks like a problem with our test instead of the functionality of the method, so we can fix that and re-run our test suite.</p><h3 name="69b3" id="69b3" class="graf graf--h3 graf-after--p">Conclusion</h3><p name="2b84" id="2b84" class="graf graf--p graf-after--h3">There’s a little bit of an additional learning curve testing in Odoo, especially if you are used to working on a vanilla python project with tools like pytest or unittest2.</p><p name="3e45" id="3e45" class="graf graf--p graf-after--p">But if you are an Odoo developer day-to-day it’s worth it.</p><p name="4588" id="4588" class="graf graf--p graf-after--p">Write more tests.</p><p name="5d3f" id="5d3f" class="graf graf--p graf-after--p">Then write even more tests.</p><p name="49fc" id="49fc" class="graf graf--p graf-after--p">They can save your ass in the long run especially as your testing suite builds up and provides more and more coverage of your project.</p><h3 name="2efa" id="2efa" class="graf graf--h3 graf-after--p">Thanks For Reading</h3><p name="6754" id="6754" class="graf graf--p graf-after--h3"><a href="https://bustererp.com" data-href="https://bustererp.com" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">Sign up for my new project called Buster</a> then let me know your thoughts.</p><p name="7341" id="7341" class="graf graf--p graf-after--p"><a href="https://twitter.com/reedrehg" data-href="https://twitter.com/reedrehg" class="markup--anchor markup--p-anchor" rel="nofollow noopener nofollow noopener nofollow noopener noopener noopener" target="_blank">Follow me on Twitter</a> for random thoughts and articles about business software and software development. Or <a href="https://medium.com/@reedrehg" data-href="https://medium.com/@reedrehg" class="markup--anchor markup--p-anchor" target="_blank">follow me directly here at Medium</a> to stay up to date with my articles.</p><p name="9865" id="9865" class="graf graf--p graf-after--p graf--trailing">Holden</p></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@reedrehg" class="p-author h-card">Holden Rehg</a> on <a href="https://medium.com/p/4355f33e4a36"><time class="dt-published" datetime="2019-02-02T20:43:29.568Z">February 2, 2019</time></a>.</p><p><a href="https://medium.com/@reedrehg/writing-tests-in-odoo-4355f33e4a36" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on October 31, 2020.</p></footer></article></body></html>