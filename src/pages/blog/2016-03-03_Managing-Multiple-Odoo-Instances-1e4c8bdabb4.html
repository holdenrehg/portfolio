<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>Managing Multiple Odoo Instances</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">Managing Multiple Odoo Instances</h1>
</header>
<section data-field="subtitle" class="p-summary">
Enterprise and Community Development
</section>
<section data-field="body" class="e-content">
<section name="c3cc" class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="d3c9" id="d3c9" class="graf graf--h3 graf--leading graf--title">Managing Multiple Odoo Instances</h3><h4 name="45a4" id="45a4" class="graf graf--h4 graf-after--h3 graf--subtitle">Enterprise and Community Development</h4></div><div class="section-inner sectionLayout--fullWidth"><figure name="be37" id="be37" class="graf graf--figure graf--layoutFillWidth graf-after--h4"><img class="graf-image" data-image-id="1*flaDihXQ1dcv1ONbadUt0A.jpeg" data-width="1920" data-height="1280" src="https://cdn-images-1.medium.com/max/2560/1*flaDihXQ1dcv1ONbadUt0A.jpeg"></figure></div><div class="section-inner sectionLayout--insetColumn"><h3 name="24a2" id="24a2" class="graf graf--h3 graf-after--figure"><strong class="markup--strong markup--h3-strong">Update — Jan 27th, 2019</strong></h3><p name="b0ab" id="b0ab" class="graf graf--p graf-after--h3">This article will still have relevant information if you are running Odoo directly on your machine or server, but I recommend reading a more updated article like <a href="https://medium.com/@reedrehg/easier-odoo-development-278bbaab38c8" data-href="https://medium.com/@reedrehg/easier-odoo-development-278bbaab38c8" class="markup--anchor markup--p-anchor" target="_blank">Easier Odoo Development</a> if you are in the position to containerize your application. — Holden</p><h3 name="bea3" id="bea3" class="graf graf--h3 graf-after--p">Managing Odoo Instances</h3><p name="c608" id="c608" class="graf graf--p graf-after--h3">Getting started with hosting Odoo can be tricky especially when trying to manage multiple instances, manage multiple editions (Odoo 8, Odoo 9 Community, Odoo 9 Enterprise), and keep a smooth development workflow. I spent some time breaking down a simpler way to install and organize Odoo on our development server and thought I would share it with any one in the community who might be interested.</p><p name="60ae" id="60ae" class="graf graf--p graf-after--p">I’m going to explain a quick example of setting up Odoo 9 Community and Odoo 9 Enterprise on a blank server, setting up a postgres server, defining service scripts, defining Odoo configurations, and running both instances from source.</p><blockquote name="3b40" id="3b40" class="graf graf--blockquote graf-after--p">This process could easily apply across multiple systems, but I will be using Ubuntu 14.04 so adapt commands as needed.</blockquote><h4 name="1516" id="1516" class="graf graf--h4 graf-after--blockquote">The Database</h4><p name="ccae" id="ccae" class="graf graf--p graf-after--h4">Odoo uses a postgresql server to store data so we need to first install and setup our database server.</p><pre name="7bd4" id="7bd4" class="graf graf--pre graf-after--p"># Install postgresql and login as the postgres user<br>$ sudo apt-get install postgresql<br>$ sudo -u postgres psql postgres</pre><pre name="1e0c" id="1e0c" class="graf graf--pre graf-after--pre"># Change the postgres users password and quit the postgres shell<br>postgres=# \password postgres<br>postgres=# \q</pre><p name="65f4" id="65f4" class="graf graf--p graf-after--pre">Odoo allows end users to manage their own databases. This can be problematic when different instances share the same database server. The best way to handle this is by creating a different postgres user for each Odoo instance. In this case, we will need 2 users, one for community and one for enterprise.</p><pre name="008f" id="008f" class="graf graf--pre graf-after--p">$ createuser -U postgres odoo-community<br>$ createuser -U postgres odoo-enterprise</pre><p name="d042" id="d042" class="graf graf--p graf-after--pre">After creating our users, we want to make sure that they have the correct permissions. We will give them the CREATEDB role so that end users can create / delete databases through Odoo.</p><pre name="81b0" id="81b0" class="graf graf--pre graf-after--p">$ psql -U postgres</pre><pre name="77e0" id="77e0" class="graf graf--pre graf-after--pre">postgres=# alter role odoo-community createdb;<br>postgres=# alter role odoo-enterprise createdb;</pre><p name="08ac" id="08ac" class="graf graf--p graf-after--pre">Finally make sure to set passwords for each user.</p><pre name="0bec" id="0bec" class="graf graf--pre graf-after--p">postgres=# \password odoo-community<br>postgres=# \password odoo-enterprise</pre><h4 name="4ada" id="4ada" class="graf graf--h4 graf-after--pre">The Source Code</h4><p name="dbfd" id="dbfd" class="graf graf--p graf-after--h4">Now that we have the two Odoo postgres users for each instance, we need the actual source code. Odoo has this split up between a couple of repositories if you are also working with enterprise. The core of odoo is stored in their <a href="https://github.com/odoo/odoo" data-href="https://github.com/odoo/odoo" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">community git repository</a> and all enterprise addons are stored in a private git repository.</p><ol class="postList"><li name="e84a" id="e84a" class="graf graf--li graf-after--p">Setup Community</li></ol><pre name="e684" id="e684" class="graf graf--pre graf-after--li">/odoo/community</pre><pre name="4702" id="4702" class="graf graf--pre graf-after--pre">- core<br>    - addons<br>    - debian<br>    - doc<br>    - openerp<br>    <br>    ...</pre><pre name="021b" id="021b" class="graf graf--pre graf-after--pre">- vendor<br>    - addons</pre><p name="9523" id="9523" class="graf graf--p graf-after--pre">Our community instance will be stored in /odoo/community with two major sections.</p><p name="794f" id="794f" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">core </strong>contains a clone of the odoo repository. This is your Odoo core code that should not be tampered with. Keeping this separate makes it easy to pull down updates directly from the git repository.</p><p name="5376" id="5376" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">vendor </strong>is a directory of all third-party code that you want to pull in. This will be your own sweet custom modules or trusted modules that you download. You will see how we set this up in our configurations as an addons path.</p><p name="77d6" id="77d6" class="graf graf--p graf-after--p">2. Setup Enterprise</p><pre name="623c" id="623c" class="graf graf--pre graf-after--p">/odoo/enterprise</pre><pre name="42f0" id="42f0" class="graf graf--pre graf-after--pre">- core<br>    - addons<br>    - debian<br>    - doc<br>    - openerp</pre><pre name="5e1d" id="5e1d" class="graf graf--pre graf-after--pre">    ...</pre><pre name="c3bf" id="c3bf" class="graf graf--pre graf-after--pre">- addons</pre><pre name="1a65" id="1a65" class="graf graf--pre graf-after--pre">- vendor<br>    - addons</pre><p name="745c" id="745c" class="graf graf--p graf-after--pre">Our community instance will be stored in /odoo/community with three major sections.</p><p name="420a" id="420a" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">core </strong>contains the same code as the community core. This could easily be a shared code base between the two instances we are setting up, but for debugging purposes, I like to keep the two separate.</p><p name="25b8" id="25b8" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">addons </strong>contains all enterprise specific addons. This is primarily going to be all the enterprise addons from the Odoo enterprise repository.</p><p name="b703" id="b703" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">vendor </strong>is a directory of all third-party code that you want to pull in. You will see how we set this up in our configurations as an addons path.</p><h4 name="9bce" id="9bce" class="graf graf--h4 graf-after--p">The Dependencies</h4><p name="2e83" id="2e83" class="graf graf--p graf-after--h4">You will want to install the python dependencies required for Odoo. The requirements.txt file provided will the Odoo core makes it easy.</p><pre name="83a4" id="83a4" class="graf graf--pre graf-after--p">$ pip install -r requirements.txt</pre><p name="0adb" id="0adb" class="graf graf--p graf-after--pre">You will also need a couple of node dependencies for stylesheets.</p><pre name="562b" id="562b" class="graf graf--pre graf-after--p">$ sudo apt-get install node-clean-css -y<br>$ sudo apt-get install node-less -y</pre><h4 name="e7f1" id="e7f1" class="graf graf--h4 graf-after--pre">The Service Scripts</h4><p name="9f53" id="9f53" class="graf graf--p graf-after--h4">Now that we have all our source setup, we will want an easy way to start / stop these different instances. Let’s start with the community script.</p><blockquote name="265d" id="265d" class="graf graf--blockquote graf-after--p">I have a user named odoo setup on my server. You will want to change the USER variable to be the name of the user that you want to own these processes.</blockquote><p name="0180" id="0180" class="graf graf--p graf-after--blockquote">You will create this file in /etc/init.d/odoo-community-server.</p><pre name="4aa5" id="4aa5" class="graf graf--pre graf-after--p">#!/bin/sh</pre><pre name="bbe7" id="bbe7" class="graf graf--pre graf-after--pre">### BEGIN INIT INFO<br># Provides: odoo-community-server<br># Required-Start: $remote_fs $syslog<br># Required-Stop: $remote_fs $syslog<br># Should-Start: $network<br># Should-Stop: $network<br># Default-Start: 2 3 4 5<br># Default-Stop: 0 1 6<br># Short-Description: Enterprise Business Applications<br># Description: ODOO Business Applications<br>### END INIT INFO</pre><pre name="6be8" id="6be8" class="graf graf--pre graf-after--pre">PATH=/bin:/sbin:/usr/bin<br>DAEMON=/odoo/community/core/openerp-server<br>NAME=odoo-community-server<br>DESC=odoo-community-server</pre><pre name="d0d2" id="d0d2" class="graf graf--pre graf-after--pre"># Specify the user name.<br>USER=odoo</pre><pre name="266d" id="266d" class="graf graf--pre graf-after--pre"># Specify a config file.<br>CONFIGFILE=”/etc/odoo-community-server.conf”</pre><pre name="c602" id="c602" class="graf graf--pre graf-after--pre"># pidfile<br>PIDFILE=/var/run/${NAME}.pid</pre><pre name="bc6e" id="bc6e" class="graf graf--pre graf-after--pre"># Additional options that are passed to the Daemon.<br>DAEMON_OPTS=”-c $CONFIGFILE”<br>[ -x $DAEMON ] || exit 0<br>[ -f $CONFIGFILE ] || exit 0<br>checkpid() {<br>[ -f $PIDFILE ] || return 1<br>pid=`cat $PIDFILE`<br>[ -d /proc/$pid ] &amp;&amp; return 0<br>return 1<br>}</pre><pre name="3fbc" id="3fbc" class="graf graf--pre graf-after--pre">case “${1}” in<br>start)<br>echo -n “Starting ${DESC}: “<br>start-stop-daemon — start — quiet — pidfile $PIDFILE — chuid $USER — background — make-pidfile — exec $DAEMON — $DAEMON_OPTS<br>echo “${NAME}.”<br>;;<br>stop)<br>echo -n “Stopping ${DESC}: “<br>start-stop-daemon — stop — quiet — pidfile $PIDFILE — oknodo<br>echo “${NAME}.”<br>;;</pre><pre name="575d" id="575d" class="graf graf--pre graf-after--pre">restart|force-reload)<br>echo -n “Restarting ${DESC}: “<br>start-stop-daemon — stop — quiet — pidfile $PIDFILE — oknodo<br>sleep 1<br>start-stop-daemon — start — quiet — pidfile $PIDFILE — chuid $USER — background — make-pidfile — exec $DAEMON — $DAEMON_OPTS<br>echo “${NAME}.”<br>;;<br>*)<br>N=/etc/init.d/$NAME<br>echo “Usage: $NAME {start|stop|restart|force-reload}” &gt;&amp;2<br>exit 1<br>;;</pre><pre name="582b" id="582b" class="graf graf--pre graf-after--pre">esac<br>exit 0</pre><p name="7e65" id="7e65" class="graf graf--p graf-after--pre">The most important pieces to notice in this config file are the following:</p><pre name="b823" id="b823" class="graf graf--pre graf-after--p"># The path to the program that will run (odoo)<br>DAEMON=/odoo/community/core/openerp-server</pre><pre name="1e74" id="1e74" class="graf graf--pre graf-after--pre"># The name of the service<br>NAME=odoo-community-server</pre><pre name="6240" id="6240" class="graf graf--pre graf-after--pre"># The path to the odoo config file<br>CONFIGFILE=”/etc/odoo-community-server.conf”</pre><p name="21fe" id="21fe" class="graf graf--p graf-after--pre">Now we want to create the same service script for the enterprise instance. This file will exists in /etc/init.d/odoo-enterprise-server and look like this.</p><pre name="5eb9" id="5eb9" class="graf graf--pre graf-after--p">#!/bin/sh</pre><pre name="86c1" id="86c1" class="graf graf--pre graf-after--pre">### BEGIN INIT INFO<br># Provides: odoo-enterprise-server<br># Required-Start: $remote_fs $syslog<br># Required-Stop: $remote_fs $syslog<br># Should-Start: $network<br># Should-Stop: $network<br># Default-Start: 2 3 4 5<br># Default-Stop: 0 1 6<br># Short-Description: Enterprise Business Applications<br># Description: ODOO Business Applications<br>### END INIT INFO</pre><pre name="cd46" id="cd46" class="graf graf--pre graf-after--pre">PATH=/bin:/sbin:/usr/bin<br>DAEMON=/odoo/enterprise/core/openerp-server<br>NAME=odoo-enterprise-server<br>DESC=odoo-enterprise-server</pre><pre name="05f5" id="05f5" class="graf graf--pre graf-after--pre"># Specify the user name.<br>USER=odoo</pre><pre name="6db6" id="6db6" class="graf graf--pre graf-after--pre"># Specify a config file.<br>CONFIGFILE=”/etc/odoo-enterprise-server.conf”</pre><pre name="a9d7" id="a9d7" class="graf graf--pre graf-after--pre"># pidfile<br>PIDFILE=/var/run/${NAME}.pid</pre><pre name="2291" id="2291" class="graf graf--pre graf-after--pre"># Additional options that are passed to the Daemon.<br>DAEMON_OPTS=”-c $CONFIGFILE”<br>[ -x $DAEMON ] || exit 0<br>[ -f $CONFIGFILE ] || exit 0<br>checkpid() {<br>[ -f $PIDFILE ] || return 1<br>pid=`cat $PIDFILE`<br>[ -d /proc/$pid ] &amp;&amp; return 0<br>return 1<br>}</pre><pre name="ba35" id="ba35" class="graf graf--pre graf-after--pre">case “${1}” in<br>start)<br>echo -n “Starting ${DESC}: “<br>start-stop-daemon — start — quiet — pidfile $PIDFILE — chuid $USER — background — make-pidfile — exec $DAEMON — $DAEMON_OPTS<br>echo “${NAME}.”<br>;;<br>stop)<br>echo -n “Stopping ${DESC}: “<br>start-stop-daemon — stop — quiet — pidfile $PIDFILE — oknodo<br>echo “${NAME}.”<br>;;</pre><pre name="fbe3" id="fbe3" class="graf graf--pre graf-after--pre">restart|force-reload)<br>echo -n “Restarting ${DESC}: “<br>start-stop-daemon — stop — quiet — pidfile $PIDFILE — oknodo<br>sleep 1<br>start-stop-daemon — start — quiet — pidfile $PIDFILE — chuid $USER — background — make-pidfile — exec $DAEMON — $DAEMON_OPTS<br>echo “${NAME}.”<br>;;<br>*)<br>N=/etc/init.d/$NAME<br>echo “Usage: $NAME {start|stop|restart|force-reload}” &gt;&amp;2<br>exit 1<br>;;</pre><pre name="7260" id="7260" class="graf graf--pre graf-after--pre">esac<br>exit 0</pre><p name="231d" id="231d" class="graf graf--p graf-after--pre">Once we setup the configuration files, you will be able to easily run the following commands to control the two seperate Odoo instances. This is much easier and manageable than running the server directly with “python odoo.py …”</p><pre name="62d2" id="62d2" class="graf graf--pre graf-after--p">$ sudo service odoo-community-server {start|stop|restart}<br>$ sudo service odoo-enterprise-server {start|stop|restart}</pre><blockquote name="ecdb" id="ecdb" class="graf graf--blockquote graf-after--pre">If you are interested in having these run on boot, make sure you add them to your defaults with “sudo update-rc.d {service-name} defaults”.</blockquote><h4 name="1787" id="1787" class="graf graf--h4 graf-after--blockquote">The Configurations</h4><p name="c711" id="c711" class="graf graf--p graf-after--h4">Finally we just have to setup the configuration files for each server. The service scripts are where these config files are referenced. Ultimatley running the service scripts will be the same as running:</p><pre name="7fd7" id="7fd7" class="graf graf--pre graf-after--p">$ python odoo.py -c /path/to/config</pre><p name="c13b" id="c13b" class="graf graf--p graf-after--pre">The community config script was set to be located in /etc/odoo-community-server.conf.</p><pre name="5965" id="5965" class="graf graf--pre graf-after--p">[options]<br>admin_passwd = admin<br>db_host = False<br>db_port = False<br>db_user = odoo-community<br>db_password = $PASSWORD<br>addons_path = /usr/lib/python2.7/dist-packages/openerp/addons<br>logfile = /var/log/odoo/odoo-community-server.log<br>addons_path = /odoo/community/core/addons,/odoo/community/vendor/addons<br>xmlrpc_port = 8070</pre><p name="a215" id="a215" class="graf graf--p graf-after--pre">We will run the community edition on port 8070 and the enterprise edition on port 8071. You are free to run them on any available ports you like though.</p><pre name="5503" id="5503" class="graf graf--pre graf-after--p">[options]<br>admin_passwd = admin<br>db_host = False<br>db_port = False<br>db_user = odoo-enterprise<br>db_password = $PASSWORD<br>addons_path = /usr/lib/python2.7/dist-packages/openerp/addons<br>logfile = /var/log/odoo/odoo-enterprise-server.log<br>addons_path = /odoo/enterprise/addons,/odoo/enterprise/core/addons,/odoo/enterprise/vendor/addons<br>xmlrpc_port = 8071</pre><blockquote name="ec79" id="ec79" class="graf graf--blockquote graf-after--pre">It is important that the enterprise addons are loaded before the community addons. The `web` module is known to conflict because that is the only shared module between the two editions that is different.</blockquote><h4 name="ae26" id="ae26" class="graf graf--h4 graf-after--blockquote">In Conclusion</h4><p name="4a52" id="4a52" class="graf graf--p graf-after--h4">Start up your servers and check out the Odoo instances running at <a href="http://servername.com:8070" data-href="http://servername.com:8070" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">http://servername.com:8070</a> and <a href="http://servername.com:8071." data-href="http://servername.com:8071." class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">http://servername.com:8071.</a></p><p name="27e0" id="27e0" class="graf graf--p graf-after--p">It takes slightly longer to setup Odoo this way (unless if you create a flexible shell script) but it has worked great for us as we constantly roll out updates to multiple editions along with our own custom modules. It keeps a nice separation of concerns between each part of the application as well.</p><p name="e72d" id="e72d" class="graf graf--p graf-after--p">We are hoping to keep improving our Odoo development workflow / environments even more! <a href="http://bluestingray.com" data-href="http://bluestingray.com" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">Let us know</a> or <a href="mailto:holdenrehg@gmail.com" data-href="mailto:holdenrehg@gmail.com" class="markup--anchor markup--p-anchor" target="_blank">send me an email</a> if the community has better ways to handle development.</p><h3 name="3348" id="3348" class="graf graf--h3 graf-after--p">Thanks For Reading</h3><p name="6754" id="6754" class="graf graf--p graf-after--h3"><a href="https://bustererp.com" data-href="https://bustererp.com" class="markup--anchor markup--p-anchor" rel="nofollow noopener noopener" target="_blank">Sign up for my new project called Buster</a> then let me know your thoughts.</p><p name="7341" id="7341" class="graf graf--p graf-after--p"><a href="https://twitter.com/reedrehg" data-href="https://twitter.com/reedrehg" class="markup--anchor markup--p-anchor" rel="nofollow noopener nofollow noopener nofollow noopener nofollow noopener noopener" target="_blank">Follow me on Twitter</a> for random thoughts and articles about business software and software development. Or <a href="https://medium.com/@reedrehg" data-href="https://medium.com/@reedrehg" class="markup--anchor markup--p-anchor" target="_blank">follow me directly here at Medium</a> to stay up to date with my articles.</p><p name="4186" id="4186" class="graf graf--p graf-after--p graf--trailing">Holden</p></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@reedrehg" class="p-author h-card">Holden Rehg</a> on <a href="https://medium.com/p/1e4c8bdabb4"><time class="dt-published" datetime="2016-03-03T05:50:49.244Z">March 3, 2016</time></a>.</p><p><a href="https://medium.com/@reedrehg/managing-multiple-odoo-instances-1e4c8bdabb4" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on October 31, 2020.</p></footer></article></body></html>